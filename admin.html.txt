<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — MSSU NCR-CL</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h3>ADMIN — Personnel</h3>

    <div class="card">
      <div class="tabs">
        <button class="tab active" data-unit="mssu-org">MSSU (Organic)</button>
        <button class="tab" data-unit="mssu-ds">MSSU (DS)</button>
        <button class="tab" data-unit="psc">PSC Division</button>
      </div>

      <div id="pscSelectWrap" style="display:none;margin-top:8px">
        <label>PSC Division</label>
        <select id="pscSelect">
          <option>PSC Div Bataan</option>
          <option>PSC Div South Harbor</option>
          <option>PSC Div North Harbor</option>
          <option>PSC Div Subic</option>
        </select>
      </div>

      <form id="adminForm" class="grid">
        <div>
          <label>Item #</label>
          <input id="itemNo" />
        </div>
        <div>
          <label>Full name & rank</label>
          <input id="fullName" />
        </div>
        <div>
          <label>Designation</label>
          <input id="designation" />
        </div>

        <div>
          <label>Assignment From</label>
          <input id="fromDate" type="date" />
        </div>
        <div>
          <label>Assignment To</label>
          <input id="toDate" type="date" />
        </div>
        <div>
          <label>Present</label>
          <input id="presentCheck" type="checkbox" />
        </div>

        <div>
          <label>Collateral</label>
          <input id="collateral" />
        </div>
        <div>
          <label>Collateral From</label>
          <input id="collFrom" type="date" />
        </div>
        <div>
          <label>Collateral To</label>
          <input id="collTo" type="date" />
        </div>

        <div>
          <label>Photo (jpg/png)</label>
          <input id="photoFile" type="file" accept="image/*" />
        </div>
        <div>
          <label>SOI (PDF / DOC / DOCX)</label>
          <input id="soiFile" type="file" accept=".pdf,.doc,.docx" />
        </div>

        <div>
          <label>Status</label>
          <select id="status">
            <option>Active duty</option><option>Schooling (Local)</option><option>Schooling (Foreign)</option>
            <option>RNR</option><option>Mandatory</option><option>Sick Leave</option><option>AWOL</option>
            <option>Training</option><option>Lecturer</option>
          </select>
        </div>

        <div>
          <label>Action</label>
          <select id="action">
            <option>Active (Organic)</option><option>Active (DS)</option><option>Transferred</option><option>Retired</option>
          </select>
        </div>

        <div style="grid-column:1/-1;display:flex;gap:8px;margin-top:8px">
          <button type="button" id="saveAdmin" class="btn">Save</button>
          <button type="button" id="clearAdmin" class="btn ghost">Clear</button>
          <button type="button" id="syncAdmin" class="btn small right">Sync Now</button>
        </div>
      </form>
    </div>

    <div class="card">
      <h4>Personnel List</h4>
      <div id="adminList"></div>
      <div id="adminTally" class="tally"></div>
    </div>

    <div class="card">
      <h4>Activity Log</h4>
      <div id="adminLog" class="muted"></div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // admin.html specific wiring uses functions exported by script.js
    // Tab switching
    document.querySelectorAll('.tabs .tab').forEach(btn=>{
      btn.onclick = ()=>{
        document.querySelectorAll('.tabs .tab').forEach(t=>t.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('pscSelectWrap').style.display = btn.dataset.unit==='psc' ? 'block' : 'none';
      };
    });

    // Save
    document.getElementById('saveAdmin').onclick = async ()=>{
      // gather form
      const form = {
        unit: document.querySelector('.tabs .tab.active').dataset.unit,
        pscDiv: document.getElementById('pscSelect').value,
        item: document.getElementById('itemNo').value,
        name: document.getElementById('fullName').value,
        designation: document.getElementById('designation').value,
        from: document.getElementById('fromDate').value,
        to: document.getElementById('toDate').value,
        present: document.getElementById('presentCheck').checked,
        collateral: document.getElementById('collateral').value,
        collFrom: document.getElementById('collFrom').value,
        collTo: document.getElementById('collTo').value,
        status: document.getElementById('status').value,
        action: document.getElementById('action').value,
        createdBy: window.currentUser || 'local',
        createdAt: new Date().toISOString()
      };

      // photo & soi -> convert to dataURL (optional), script.js helper handles file reads
      await saveAdminRecord(form, document.getElementById('photoFile').files[0], document.getElementById('soiFile').files[0]);
      // clear form
      document.getElementById('adminForm').reset();
    };

    document.getElementById('clearAdmin').onclick = ()=>document.getElementById('adminForm').reset();
    document.getElementById('syncAdmin').onclick = ()=>syncNow();

    // initial display
    renderAdminList();
  </script>
</body>
</html>